"""

"""

# TODO: All Positve
# TODO: All Negative
# TODO: Big Numbers
# TODO: n=0, n=1, n=2

import pytest

from typing import List, Set
from curvepy.voronoi.delaunay_triangulation import DelaunayTriangulation2D, Triangle, Point2D

# Needed for Debug Functions
import matplotlib.pyplot as plt
import numpy as np
from curvepy.dev.reference_implementation import Delaunay2D

RANDOMLY_UNIFORMLY_DISTRIBUTED = [
    # n=10 2D-points each
    # (min,max)=(-20,20)
    #
    # Called with center=(0,0), radius=500 (for degraded circumcircles)
    # All are tested against the reference implementation
    (
        [(-2.464519260333624, -3.5339998292951194), (-0.660124558197829, -4.014126033623352),
         (-0.773689051649832, 11.295002309487042), (-12.758707985380276, -16.828983563606265),
         (-6.319057044766186, -8.16828294254587), (-2.5259795771588074, -13.179931595424787),
         (-0.3737640303519605, -18.238919912136975), (1.3013870199730668, -14.477058193138745),
         (-12.14983214210029, 0.9243564544804386), (7.702281083060289, 9.752314067467044)],
        {Triangle(*pts) for pts in
         [
             [(-2.464519260333624, -3.5339998292951194), (-0.773689051649832, 11.295002309487042),
              (-0.660124558197829, -4.014126033623352)],
             [(-6.319057044766186, -8.16828294254587), (-2.464519260333624, -3.5339998292951194),
              (-0.660124558197829, -4.014126033623352)],
             [(-12.758707985380276, -16.828983563606265), (-6.319057044766186, -8.16828294254587),
              (-2.5259795771588074, -13.179931595424787)],
             [(-6.319057044766186, -8.16828294254587), (-2.5259795771588074, -13.179931595424787),
              (-0.660124558197829, -4.014126033623352)],
             [(-12.758707985380276, -16.828983563606265), (-2.5259795771588074, -13.179931595424787),
              (-0.3737640303519605, -18.238919912136975)],
             [(-2.5259795771588074, -13.179931595424787), (-0.660124558197829, -4.014126033623352),
              (1.3013870199730668, -14.477058193138745)],
             [(-2.5259795771588074, -13.179931595424787), (-0.3737640303519605, -18.238919912136975),
              (1.3013870199730668, -14.477058193138745)],
             [(-12.14983214210029, 0.9243564544804386), (-2.464519260333624, -3.5339998292951194),
              (-0.773689051649832, 11.295002309487042)],
             [(-12.758707985380276, -16.828983563606265), (-12.14983214210029, 0.9243564544804386),
              (-6.319057044766186, -8.16828294254587)],
             [(-12.14983214210029, 0.9243564544804386), (-6.319057044766186, -8.16828294254587),
              (-2.464519260333624, -3.5339998292951194)],
             [(-0.660124558197829, -4.014126033623352), (1.3013870199730668, -14.477058193138745),
              (7.702281083060289, 9.752314067467044)],
             [(-0.773689051649832, 11.295002309487042), (-0.660124558197829, -4.014126033623352),
              (7.702281083060289, 9.752314067467044)]
         ]}
    ),
    (
        [(-18.598865105531605, 4.677355804291722), (17.642366397536748, 2.031134906608436),
         (-14.11900193399783, -9.661473310166496), (7.917830741258896, 19.011807560008187),
         (19.252809957165027, -19.71697400344937), (8.295958070872409, -8.12657050313788),
         (19.68272710229777, 15.578598823155218), (-2.53925788979819, -12.51095640931419),
         (-1.5353477514257285, 0.9295432949623716), (7.070138216749619, -16.996919905921004)],
        {Triangle(*pts) for pts in
         [
             [(8.295958070872409, -8.12657050313788), (17.642366397536748, 2.031134906608436),
              (19.252809957165027, -19.71697400344937)],
             [(7.917830741258896, 19.011807560008187), (17.642366397536748, 2.031134906608436),
              (19.68272710229777, 15.578598823155218)],
             [(17.642366397536748, 2.031134906608436), (19.252809957165027, -19.71697400344937),
              (19.68272710229777, 15.578598823155218)],
             [(-2.53925788979819, -12.51095640931419), (-1.5353477514257285, 0.9295432949623716),
              (8.295958070872409, -8.12657050313788)],
             [(-1.5353477514257285, 0.9295432949623716), (8.295958070872409, -8.12657050313788),
              (17.642366397536748, 2.031134906608436)],
             [(-1.5353477514257285, 0.9295432949623716), (7.917830741258896, 19.011807560008187),
              (17.642366397536748, 2.031134906608436)],
             [(-18.598865105531605, 4.677355804291722), (-1.5353477514257285, 0.9295432949623716),
              (7.917830741258896, 19.011807560008187)],
             [(-18.598865105531605, 4.677355804291722), (-14.11900193399783, -9.661473310166496),
              (-1.5353477514257285, 0.9295432949623716)],
             [(-14.11900193399783, -9.661473310166496), (-2.53925788979819, -12.51095640931419),
              (-1.5353477514257285, 0.9295432949623716)],
             [(-2.53925788979819, -12.51095640931419), (7.070138216749619, -16.996919905921004),
              (8.295958070872409, -8.12657050313788)],
             [(7.070138216749619, -16.996919905921004), (8.295958070872409, -8.12657050313788),
              (19.252809957165027, -19.71697400344937)],
             [(-14.11900193399783, -9.661473310166496), (-2.53925788979819, -12.51095640931419),
              (7.070138216749619, -16.996919905921004)]
         ]}
    ),
    (
        [(3.594542826868757, 7.33901439793997), (1.665357039403034, -9.08129597424689),
         (-1.8579898433828212, -18.989311492800493), (-10.928225232942994, 17.732611662378083),
         (18.029424193400317, 14.633852320866517), (-5.633722740810336, -5.770315302104553),
         (-18.084033983439546, 6.37692972415509), (-10.604956231769481, -1.5925760516756249),
         (-0.4061097121198678, -14.681782596355927), (-13.793300803424131, -19.69388707032671)],
        {Triangle(*pts) for pts in
         [
             [(1.665357039403034, -9.08129597424689), (3.594542826868757, 7.33901439793997),
              (18.029424193400317, 14.633852320866517)],
             [(-10.928225232942994, 17.732611662378083), (3.594542826868757, 7.33901439793997),
              (18.029424193400317, 14.633852320866517)],
             [(-5.633722740810336, -5.770315302104553), (1.665357039403034, -9.08129597424689),
              (3.594542826868757, 7.33901439793997)],
             [(-18.084033983439546, 6.37692972415509), (-10.928225232942994, 17.732611662378083),
              (-10.604956231769481, -1.5925760516756249)],
             [(-10.604956231769481, -1.5925760516756249), (-5.633722740810336, -5.770315302104553),
              (3.594542826868757, 7.33901439793997)],
             [(-10.928225232942994, 17.732611662378083), (-10.604956231769481, -1.5925760516756249),
              (3.594542826868757, 7.33901439793997)],
             [(-1.8579898433828212, -18.989311492800493), (-0.4061097121198678, -14.681782596355927),
              (18.029424193400317, 14.633852320866517)],
             [(-5.633722740810336, -5.770315302104553), (-0.4061097121198678, -14.681782596355927),
              (1.665357039403034, -9.08129597424689)],
             [(-0.4061097121198678, -14.681782596355927), (1.665357039403034, -9.08129597424689),
              (18.029424193400317, 14.633852320866517)],
             [(-13.793300803424131, -19.69388707032671), (-5.633722740810336, -5.770315302104553),
              (-0.4061097121198678, -14.681782596355927)],
             [(-18.084033983439546, 6.37692972415509), (-13.793300803424131, -19.69388707032671),
              (-10.604956231769481, -1.5925760516756249)],
             [(-13.793300803424131, -19.69388707032671), (-1.8579898433828212, -18.989311492800493),
              (-0.4061097121198678, -14.681782596355927)],
             [(-13.793300803424131, -19.69388707032671), (-10.604956231769481, -1.5925760516756249),
              (-5.633722740810336, -5.770315302104553)]
         ]}
    ),
    (
        [(-1.3162600263586128, 6.780277246556196), (4.7275782170697696, 17.99986515382742),
         (1.4732576347808148, 17.09278333425069), (17.592459784909117, 4.05936951684232),
         (-19.874842348052148, 2.532995781099995), (-0.15778198203077665, 18.75826722719114),
         (-19.635296339870763, 9.512647094148775), (-5.191889786603493, 7.235283487422741),
         (-16.57338447485341, -13.289565043397022), (-2.042829987787151, -12.806353294202726)],
        {Triangle(*pts) for pts in
         [
             [(-1.3162600263586128, 6.780277246556196), (1.4732576347808148, 17.09278333425069),
              (4.7275782170697696, 17.99986515382742)],
             [(-1.3162600263586128, 6.780277246556196), (4.7275782170697696, 17.99986515382742),
              (17.592459784909117, 4.05936951684232)],
             [(-0.15778198203077665, 18.75826722719114), (1.4732576347808148, 17.09278333425069),
              (4.7275782170697696, 17.99986515382742)],
             [(-19.635296339870763, 9.512647094148775), (-5.191889786603493, 7.235283487422741),
              (-0.15778198203077665, 18.75826722719114)],
             [(-5.191889786603493, 7.235283487422741), (-0.15778198203077665, 18.75826722719114),
              (1.4732576347808148, 17.09278333425069)],
             [(-19.874842348052148, 2.532995781099995), (-19.635296339870763, 9.512647094148775),
              (-5.191889786603493, 7.235283487422741)],
             [(-5.191889786603493, 7.235283487422741), (-1.3162600263586128, 6.780277246556196),
              (1.4732576347808148, 17.09278333425069)],
             [(-19.874842348052148, 2.532995781099995), (-16.57338447485341, -13.289565043397022),
              (-5.191889786603493, 7.235283487422741)],
             [(-16.57338447485341, -13.289565043397022), (-5.191889786603493, 7.235283487422741),
              (-2.042829987787151, -12.806353294202726)],
             [(-5.191889786603493, 7.235283487422741), (-2.042829987787151, -12.806353294202726),
              (-1.3162600263586128, 6.780277246556196)],
             [(-2.042829987787151, -12.806353294202726), (-1.3162600263586128, 6.780277246556196),
              (17.592459784909117, 4.05936951684232)]
         ]}
    ),
    (
        [(2.57560948079346, 7.261488888907806), (18.522537042712287, 1.2056851283257473),
         (-17.473688642078116, 14.783124968548492), (-8.239103327227717, -15.782775739784189),
         (-13.794499341700487, 16.700748666983998), (10.074784709479442, 7.790914767646939),
         (-19.64676174578036, -3.7000647695745386), (-12.345380559563734, -6.948393502524093),
         (14.286858908479253, -10.628140311249673), (-19.697242836581022, -4.49505652037284)],
        {Triangle(*pts) for pts in
         [
             [(-13.794499341700487, 16.700748666983998), (2.57560948079346, 7.261488888907806),
              (10.074784709479442, 7.790914767646939)],
             [(-19.64676174578036, -3.7000647695745386), (-17.473688642078116, 14.783124968548492),
              (-12.345380559563734, -6.948393502524093)],
             [(-17.473688642078116, 14.783124968548492), (-13.794499341700487, 16.700748666983998),
              (-12.345380559563734, -6.948393502524093)],
             [(-13.794499341700487, 16.700748666983998), (-12.345380559563734, -6.948393502524093),
              (2.57560948079346, 7.261488888907806)],
             [(-12.345380559563734, -6.948393502524093), (-8.239103327227717, -15.782775739784189),
              (2.57560948079346, 7.261488888907806)],
             [(10.074784709479442, 7.790914767646939), (14.286858908479253, -10.628140311249673),
              (18.522537042712287, 1.2056851283257473)],
             [(2.57560948079346, 7.261488888907806), (10.074784709479442, 7.790914767646939),
              (14.286858908479253, -10.628140311249673)],
             [(-8.239103327227717, -15.782775739784189), (2.57560948079346, 7.261488888907806),
              (14.286858908479253, -10.628140311249673)],
             [(-19.697242836581022, -4.49505652037284), (-12.345380559563734, -6.948393502524093),
              (-8.239103327227717, -15.782775739784189)],
             [(-19.697242836581022, -4.49505652037284), (-19.64676174578036, -3.7000647695745386),
              (-12.345380559563734, -6.948393502524093)]
         ]}
    ),
    (
        [(-16.05563522413593, -15.861182232164595), (-14.916265285856781, 19.5248585555644),
         (3.3134575840174563, -1.132290192495109), (10.59309970082063, -2.176975103803123),
         (3.2022861215688323, -2.8755786085711286), (-18.369693884794863, 3.4904403180721104),
         (-8.149659140060258, -11.087730077350058), (2.116975317653594, 19.739395932307488),
         (16.933548895106142, 9.576472306543998), (-14.24574896223072, 6.59662253528078)],
        {Triangle(*pts) for pts in
         [
             [(3.2022861215688323, -2.8755786085711286), (3.3134575840174563, -1.132290192495109),
              (10.59309970082063, -2.176975103803123)],
             [(-8.149659140060258, -11.087730077350058), (3.2022861215688323, -2.8755786085711286),
              (10.59309970082063, -2.176975103803123)],
             [(-18.369693884794863, 3.4904403180721104), (-16.05563522413593, -15.861182232164595),
              (-8.149659140060258, -11.087730077350058)],
             [(-8.149659140060258, -11.087730077350058), (3.2022861215688323, -2.8755786085711286),
              (3.3134575840174563, -1.132290192495109)],
             [(-16.05563522413593, -15.861182232164595), (-8.149659140060258, -11.087730077350058),
              (10.59309970082063, -2.176975103803123)],
             [(3.3134575840174563, -1.132290192495109), (10.59309970082063, -2.176975103803123),
              (16.933548895106142, 9.576472306543998)],
             [(2.116975317653594, 19.739395932307488), (3.3134575840174563, -1.132290192495109),
              (16.933548895106142, 9.576472306543998)],
             [(-14.24574896223072, 6.59662253528078), (-8.149659140060258, -11.087730077350058),
              (3.3134575840174563, -1.132290192495109)],
             [(-14.916265285856781, 19.5248585555644), (-14.24574896223072, 6.59662253528078),
              (2.116975317653594, 19.739395932307488)],
             [(-18.369693884794863, 3.4904403180721104), (-14.24574896223072, 6.59662253528078),
              (-8.149659140060258, -11.087730077350058)],
             [(-14.24574896223072, 6.59662253528078), (2.116975317653594, 19.739395932307488),
              (3.3134575840174563, -1.132290192495109)],
             [(-18.369693884794863, 3.4904403180721104), (-14.916265285856781, 19.5248585555644),
              (-14.24574896223072, 6.59662253528078)]
         ]}
    ),
    (
        [(-6.884089723062674, -6.054428139055933), (-3.065352744149802, 18.647459834356006),
         (-14.594882405343235, -16.984670236598024), (-6.2708045753628525, 8.285634546605081),
         (-5.689270894254413, 2.6947287504807846), (2.9891927242286087, -4.201745962700887),
         (2.5138364469879804, -0.2256329232360912), (7.737828051210691, 13.454266082018016),
         (-7.132790008685026, -15.939539810247997), (2.4844492758430192, -3.788825561645087)],
        {Triangle(*pts) for pts in
         [
             [(-14.594882405343235, -16.984670236598024), (-6.884089723062674, -6.054428139055933),
              (-5.689270894254413, 2.6947287504807846)],
             [(-14.594882405343235, -16.984670236598024), (-6.2708045753628525, 8.285634546605081),
              (-5.689270894254413, 2.6947287504807846)],
             [(-6.2708045753628525, 8.285634546605081), (-5.689270894254413, 2.6947287504807846),
              (2.5138364469879804, -0.2256329232360912)],
             [(2.5138364469879804, -0.2256329232360912), (2.9891927242286087, -4.201745962700887),
              (7.737828051210691, 13.454266082018016)],
             [(-6.2708045753628525, 8.285634546605081), (2.5138364469879804, -0.2256329232360912),
              (7.737828051210691, 13.454266082018016)],
             [(-6.2708045753628525, 8.285634546605081), (-3.065352744149802, 18.647459834356006),
              (7.737828051210691, 13.454266082018016)],
             [(-7.132790008685026, -15.939539810247997), (-6.884089723062674, -6.054428139055933),
              (2.9891927242286087, -4.201745962700887)],
             [(-14.594882405343235, -16.984670236598024), (-7.132790008685026, -15.939539810247997),
              (-6.884089723062674, -6.054428139055933)],
             [(-6.884089723062674, -6.054428139055933), (2.4844492758430192, -3.788825561645087),
              (2.9891927242286087, -4.201745962700887)],
             [(2.4844492758430192, -3.788825561645087), (2.5138364469879804, -0.2256329232360912),
              (2.9891927242286087, -4.201745962700887)],
             [(-6.884089723062674, -6.054428139055933), (-5.689270894254413, 2.6947287504807846),
              (2.4844492758430192, -3.788825561645087)],
             [(-5.689270894254413, 2.6947287504807846), (2.4844492758430192, -3.788825561645087),
              (2.5138364469879804, -0.2256329232360912)]
         ]}
    ),
    (
        [(14.528590922531443, -7.75549896434792), (11.865187343967595, -6.065834689396944),
         (-13.632474403099515, 16.998299218089763), (4.7921585289845865, 16.79159856345767),
         (-15.000959157490591, 8.634235873045991), (17.550338884578473, -3.296212989852286),
         (2.472319234147765, 12.432083120603302), (-17.194679401098398, 12.383072326622383),
         (-8.936431957113381, -3.9564331246693882), (-12.455966667386345, 14.334822277277247)],
        {Triangle(*pts) for pts in
         [
             [(11.865187343967595, -6.065834689396944), (14.528590922531443, -7.75549896434792),
              (17.550338884578473, -3.296212989852286)],
             [(2.472319234147765, 12.432083120603302), (11.865187343967595, -6.065834689396944),
              (17.550338884578473, -3.296212989852286)],
             [(2.472319234147765, 12.432083120603302), (4.7921585289845865, 16.79159856345767),
              (17.550338884578473, -3.296212989852286)],
             [(-17.194679401098398, 12.383072326622383), (-15.000959157490591, 8.634235873045991),
              (-8.936431957113381, -3.9564331246693882)],
             [(-8.936431957113381, -3.9564331246693882), (2.472319234147765, 12.432083120603302),
              (11.865187343967595, -6.065834689396944)],
             [(-8.936431957113381, -3.9564331246693882), (11.865187343967595, -6.065834689396944),
              (14.528590922531443, -7.75549896434792)],
             [(-15.000959157490591, 8.634235873045991), (-8.936431957113381, -3.9564331246693882),
              (2.472319234147765, 12.432083120603302)],
             [(-17.194679401098398, 12.383072326622383), (-15.000959157490591, 8.634235873045991),
              (-12.455966667386345, 14.334822277277247)],
             [(-13.632474403099515, 16.998299218089763), (-12.455966667386345, 14.334822277277247),
              (4.7921585289845865, 16.79159856345767)],
             [(-12.455966667386345, 14.334822277277247), (2.472319234147765, 12.432083120603302),
              (4.7921585289845865, 16.79159856345767)],
             [(-17.194679401098398, 12.383072326622383), (-13.632474403099515, 16.998299218089763),
              (-12.455966667386345, 14.334822277277247)],
             [(-15.000959157490591, 8.634235873045991), (-12.455966667386345, 14.334822277277247),
              (2.472319234147765, 12.432083120603302)]
         ]}
    )
]


def compare_to_reference_implementation(list_of_inputs_outputs, radius=500):
    """Debugging helper for visualizing the Delaunay Triangulation compared to the reference implementation"""
    j = 0
    for i, _ in list_of_inputs_outputs:
        d = DelaunayTriangulation2D(radius=radius)
        for pt in i:
            d.add_point(pt)

        plt.rcParams["figure.figsize"] = (5, 10)
        figure, axis = plt.subplots(2)

        axis[0].set_title(f"meins {j}")
        trianglerinos = d.triangles
        for tri in trianglerinos:
            points = np.ravel(tri.points)
            axis[0].triplot(points[0::2], points[1::2])

        axis[1].set_title("reference implementation")
        d2 = Delaunay2D(radius=1000)
        for pt in i:
            d2.addPoint(pt)
        coord, tris = d2.exportDT()
        my_tris = [(coord[a], coord[b], coord[c]) for a, b, c in tris]
        for tri in my_tris:
            points = np.ravel(tri)
            axis[1].triplot(points[0::2], points[1::2])
        plt.show()
        j += 1


def generate_output_from_input(list_of_inputs_outputs, radius=500):
    ret = []
    for i, _ in list_of_inputs_outputs:
        current = "{Triangle(*pts) for pts in \n["
        d = DelaunayTriangulation2D(radius=radius)
        for pt in i:
            d.add_point(pt)
        tris = d.triangles
        pts = [t.points for t in tris]
        for t in pts:
            current += f"\n{t},"
        # remove last comma
        current = current[:-1]
        current += "\n]}"
        ret.append(current)
    return ret


@pytest.mark.parametrize('input, expected', RANDOMLY_UNIFORMLY_DISTRIBUTED)
def test_random_uniform_distribution(input: List[Point2D], expected: Set[Triangle]):
    d = DelaunayTriangulation2D(radius=500)
    for pt in input:
        d.add_point(pt)
    assert set(d.triangles) == expected
